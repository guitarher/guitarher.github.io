<script setup>
  import img from '/imgs/前端基础/网络7层协议.jpg'
  import img1 from '/imgs/前端基础/请求过程.png'
  import img2 from '/imgs/前端基础/网络分层.png'
  import img3 from '/imgs/前端基础/A类IP.png'
  import img4 from '/imgs/前端基础/B类IP.png'
  import img5 from '/imgs/前端基础/C类IP.png'
  import img6 from '/imgs/前端基础/D类IP.png'
  import img7 from '/imgs/前端基础/E类IP.png'
</script>

## 网络互连模型

> - 为了更好地促进互联网络的研究和发展，国际标准化组织ISO 在1985年制定了网络互连模型
>
> - OSI 参考模型（Open System Interconnect Reference Model），具有7 层结构

<img :src="img"/>

## 请求过程

> 从客户端到服务器的请求，从图上可以看出来，类似于js事件传递的过程（捕获阶段--->冒泡阶段），经过每一层都会在数据包上添加或者减少一些信息

<img :src="img1"/>

## 网络分层

<img :src="img2"/>

## 计算机之间的通信基础

- 需要得知对方的IP地址
- 最终是根据MAC地址（网卡地址），输送数据到网卡，被网卡接收
- 如果网卡发现数据的目标MAC地址是自己，就会将数据传递给上一层进行处理
- 如果网卡发现数据的目标MAC地址不是自己，就会将数据丢弃，不会传递给上一层进行处理

## MAC地址

- 每一个网卡都有一个6字节（48bit）的MAC地址（Media Access Control Address）
- 全球唯一，固化在了网卡的ROM中，由IEEE802标准规定
- 前3字节：OUI (Organizationally Unique Identifier)，组织唯一标识符，由IEEE的注册管理机构分配给厂商。
- 后3字节：网络接口标识符，由厂商自行分配。

## MAC地址的表示格式

- Windows: `40-55-82-0A-8C-6D`
- Linux、Android、Mac、iOS: `40:55:82:0A:8C:6D`
- Packet Tracer: `40:55.820A.8C6D`
- 当48位全为1时，代表广播地址: `FF-FF-FF-FF-FF-FF`

## MAC地址操作

- 查看MAC地址：`ipconfig /all`
- 修改MAC地址：更改适配器选项 - 属性 - 配置 - 高级 - 网络地址
- 填写的时候需要把减号（-）去掉
- 有时可以通过修改MAC地址蹭网

## MAC地址的获取

- 当不知道对方主机的MAC地址时，可以通过发送ARP广播获取对方的MAC地址。
- 获取成功后，会缓存IP地址、MAC地址的映射信息，俗称：ARP缓存。
- 通过ARP广播获取的MAC地址，属于动态（dynamic）缓存，存储时间比较短（默认是2分钟），过期了就自动删除。

- 相关命令

  ```js
  - `arp -a [主机地址]`: 查询ARP缓存
  - `arp -d [主机地址]`: 删除ARP缓存
  - `arp -s 主机地址 MAC地址`: 增加一条缓存信息（这是静态缓存，存储时间较久，不同系统的存储时间不同）
  ```

## ARP(广播)

- **ARP (Address Resolution Protocol)**，译为：地址解析协议

  > - 通过IP地址获取MAC地址

- **RARP (Reverse Address Resolution Protocol)**，译为：逆地址解析协议

  > - 使用与ARP相同的报头结构
  > - 作用与ARP相反，用于将MAC地址转换为IP地址
  > - 后来被BOOTP、DHCP所取代

## ICMP

- **ICMP (Internet Control Message Protocol)**，译为：互联网控制消息协议。是TCP/IP协议族中的一个子协议，主要用于在IP网络中传递控制消息。

- IPv4中的ICMP被称作ICMPv4，IPv6中的ICMP则被称作ICMPv6。

- 通常用于返回错误信息，比如TTL值过期、目的不可达。

- ICMP的错误消息总是包括了源数据并返回给发送者。

- 主要功能

  > 1. **错误报告**：当数据包无法到达目的地时，ICMP会发送错误消息（如“目标不可达”）。
  > 2. **网络诊断**：通过工具如ping和traceroute，ICMP帮助检测网络连通性和路径。
  > 3. **流量控制**：当路由器过载时，ICMP可以发送“源抑制”消息，要求发送方降低数据发送速率。

- 常见消息类型

  > - **Echo请求与回复（Type 8/0）**：用于ping工具，测试主机之间的连通性。
  > - **目标不可达（Type 3）**：表示数据包无法到达目的地。
  > - **超时（Type 11）**：当数据包的TTL值减至0时发送，用于traceroute工具。
  > - **重定向（Type 5）**：通知主机有更优的路由路径。

## IP地址

- IP地址（Internet Protocol Address）：互联网上的每一个主机都有一个IP地址。
- 最初是IPv4版本，32bit（4字节），2019年11月25日，全球的IP地址已经用完。
- 后面推出了IPv6版本，128bit（16字节）。

## IP地址的组成

- IP地址由2部分组成：网络标识（网络ID）、主机标识（主机ID）。
- 通过子网掩码（subnet mask）可以得知网络ID、主机ID。
- 主机所在的网段 = 子网掩码 & IP地址。
- 计算机和其他计算机通信前，会先判断目标主机和自己是否在同一网段。
  - 同一网段：不需要由路由器进行转发。
  - 不同网段：交由路由器进行转发。

## IP地址的分类

- **A类地址**：默认子网掩码是255.0.0.0，网络ID 0~127，主机ID 0~255。

  - | 8bit            | 24bit  |
      | --------------- | ------ |
      | 网络ID（0开头） | 主机ID |
      
  - <img :src="img3"/>
  - 网络ID
  
    > - 0不能用，127作为保留网段。其中127.0.0.1是本地环回地址（Loopback），代表本机地址
    > - 可以分配给主机的
    > - 第1部分的取值范围是：1~126
  
  - 主机ID

    > - 第2、3、4部分的取值范围是：0~255
    >
    > - 每个A类网络能容纳的最大主机数是：256 * 256 * 256 –2 = 2的24次方–2 = 16777214
  
- **B类地址**：默认子网掩码是255.255.0.0，网络ID 128~191，主机ID 0~255。

  | 16bit            | 16bit  |
  | ---------------- | ------ |
  | 网络ID（10开头） | 主机ID |

  - <img :src="img4"/>

  - 网络ID

    > - 第1部分的取值范围是：128~191 
    >
    > - 第2部分的取值范围是：0~255

  - 主机ID

    > - 第3、4部分的取值范围是：0~255
    >
    > - 每个B类网络能容纳的最大主机数是：256 * 256 –2 = 2的16次方–2 = 65534
    >

- **C类地址**：默认子网掩码是255.255.255.0，网络ID 192~223，主机ID 0~255。

  | 24bit             | 8bit   |
  | ----------------- | ------ |
  | 网络ID（110开头） | 主机ID |

  - <img :src="img5"/>

  - 网络ID

    > - 可以分配给主机的
    > - 第1部分的取值范围是：192~223 
    > - 第2、3部分的取值范围是：0~255

  - 主机ID

    > - 第4部分的取值范围是：0~255
    >
    > - 每个C类网络能容纳的最大主机数是：256 –2 = 254
    >

- **D类地址**：以1110开头，没有子网掩码，用于多播（组播）地址。

  - 第1部分取值范围是：224~239
  - <img :src="img6"/>

- **E类地址**：以1111开头，保留为今后使用。

  - 第1部分取值范围是：240~255
  - <img :src="img7"/>

## 子网掩码的CIDR表示方法

- CIDR（Classless Inter-Domain Routing）：无类别域间路由。
- 子网掩码的CIDR表示方法：
  - `192.168.1.100/24`，代表子网掩码有24个1，也就是255.255.255.0。
  - `123.210.100.200/16`，代表子网掩码有16个1，也就是255.255.0.0。

## 子网划分

- 子网划分：借用主机位作子网位，划分出多个子网。
- 可以分为：
  - 等长子网划分：将一个网段等分成多个子网，每个子网的可用IP地址数量是一样的。
  - 变长子网划分：每个子网的可用IP地址数量可以是不一样的。
- 子网划分的步骤
  1. 确定子网的子网掩码长度。
  2. 确定子网中第1个、最后1个主机可用的IP地址。

## 超网

- **超网**: 跟子网反过来，它是将多个连续的网段合并成一个更大的网段。
- **需求**: 原本有200台计算机使用192.168.0.0/24网段，现在希望增加200台设备到同一个网段。
- 合并192.168.0.0/24、192.168.1.0/24为一个网段：192.168.0.0/23（子网掩码往左移动1位）。

## 合并网段的规律

- 假设n是2的长次幂（k≥1），子网掩码左移k位能够将能够合并n个网段。
- 如果第一个网段的网络号能被n整除，那么由它开始连续的n个网段，能通过左移k位子网掩码进行合并。

## 判断一个网段是子网还是超网

- **首先**：看看该网段的类型，是A类网络、B类网络、C类网络？
- **然后**：
  - 如果该网段的子网掩码位数比默认子网掩码多，就是子网。
  - 如果该网段的子网掩码位数比默认子网掩码少，则是超网。

**例如**：

- `25.100.0.0/16` 是一个A类子网。
- `200.100.0.0/16` 是一个C类超网。